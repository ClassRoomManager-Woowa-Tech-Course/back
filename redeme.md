# ê°•ì˜ì‹¤ ê´€ë¦¬ ì‹œìŠ¤í…œ - Backend

> ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ - ì˜¤í”ˆê³¼ì œ ë°±ì—”ë“œ API ì„œë²„

ê°•ì˜ì‹¤ ì˜ˆì•½ ë° ê´€ë¦¬ë¥¼ ìœ„í•œ RESTful API ì„œë²„ì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ì†Œê°œ](#-í”„ë¡œì íŠ¸-ì†Œê°œ)
- [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ì‹œì‘í•˜ê¸°](#-ì‹œì‘í•˜ê¸°)
- [API ë¬¸ì„œ](#-api-ë¬¸ì„œ)
- [í™˜ê²½ ì„¤ì •](#-í™˜ê²½-ì„¤ì •)

## ğŸ¯ í”„ë¡œì íŠ¸ ì†Œê°œ

Spring Boot ê¸°ë°˜ì˜ ê°•ì˜ì‹¤ ê´€ë¦¬ ì‹œìŠ¤í…œ ë°±ì—”ë“œ API ì„œë²„ì…ë‹ˆë‹¤.
í•™ìƒê³¼ êµì§ì›ì˜ ê°•ì˜ì‹¤ ì˜ˆì•½, ê´€ë¦¬ìì˜ ê°€ì´ë“œë¼ì¸ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
ì¶”ê°€ë¡œ ê³ ì¥ ì‹ ê³ ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### 1. ì˜ˆì•½ ê´€ë¦¬
- ê°•ì˜ì‹¤ ì˜ˆì•½ ë“±ë¡
- ì˜ˆì•½ ì¡°íšŒ (ëª©ë¡/ìƒì„¸)
- ì˜ˆì•½ ìˆ˜ì • ë° ì·¨ì†Œ
- ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ ì˜ˆì•½ ë³´í˜¸

### 2. ê°€ì´ë“œë¼ì¸ ê´€ë¦¬
- ê°•ì˜ì‹¤ë³„ ì‚¬ìš© ê°€ì´ë“œë¼ì¸ ë“±ë¡
- ê°€ì´ë“œë¼ì¸ ì¡°íšŒ
- íŒŒì¼ ì²¨ë¶€ (AWS S3 ì—°ë™)

### 3. ê°•ì˜ì‹¤ ê´€ë¦¬
- ê°•ì˜ì‹¤ ëª©ë¡ ì¡°íšŒ
- ì´ˆê¸° ê°•ì˜ì‹¤ ë°ì´í„° ìë™ ì„¤ì •

### 4. ì¸ì¦/ì¸ê°€
- JWT ê¸°ë°˜ ê´€ë¦¬ì ì¸ì¦
- ì´ˆê¸° ê´€ë¦¬ì ê³„ì • ìë™ ìƒì„±

### 5. ê³ ì¥ ì‹ ê³ 
- ê°•ì˜ì‹¤ ê³ ì¥ ì‹ ê³ 
- ê°•ì˜ì‹¤ ê³ ì¥ ì‹ ê³  ëª©ë¡ ì¡°íšŒ
- ê³ ì¥ ìˆ˜ë¦¬ ì™„ë£Œ ì²˜ë¦¬

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Backend Framework
- **Spring Boot 3.x** - ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬
- **Spring Data JPA** - ORM
- **Spring Security** - ì¸ì¦/ì¸ê°€
- **Spring Web** - RESTful API

### Database
- **MySQL 8.0** - ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤
- **Docker Compose** - ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

### Cloud & Storage
- **AWS S3** - íŒŒì¼ ìŠ¤í† ë¦¬ì§€ (ì´ë¯¸ì§€/ë¬¸ì„œ)
- **Spring Cloud AWS** - AWS SDK í†µí•©

### Security
- **JWT (JSON Web Token)** - í† í° ê¸°ë°˜ ì¸ì¦
- **BCrypt** - ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”

### Build Tool
- **Gradle** (ì¶”ì •)

## ğŸš€ ì‹œì‘í•˜ê¸°

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- Java 17+
- Docker & Docker Compose
- AWS ê³„ì • (S3 ì‚¬ìš©)

### 1. ì €ì¥ì†Œ í´ë¡ 
```bash
git clone [repository-url]
cd classroom-manager-backend
```

### 2. Dockerë¡œ MySQL ì‹¤í–‰
```bash
docker-compose up -d
```

### 3. ë¡œì»¬ ì„¤ì • íŒŒì¼ ìƒì„±

**`src/main/resources/application-local.yml` íŒŒì¼ ìƒì„±:**
```yaml
# AWS S3 ì„¤ì •
spring:
  cloud:
    aws:
      s3:
        bucket: {bucket ì´ë¦„}
      credentials:
        access-key: {access key}
        secret-key: {secret-key}

# ê´€ë¦¬ì ê³„ì •
admin:
  super:
    id: super_admin
    password: super_admin

# JWT
jwt:
  secret-key: {secret key}

# Frontend URL
front:
  url: http://localhost:5173
```

âš ï¸ **ë³´ì•ˆ ì£¼ì˜ì‚¬í•­**:
- `application-local.yml` íŒŒì¼ì€ ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”
- `.gitignore`ì— ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” AWS Secrets Manager ì‚¬ìš© ê¶Œì¥

### 4. .gitignore í™•ì¸
```gitignore
# ë¯¼ê°í•œ ì„¤ì • íŒŒì¼ (ë°˜ë“œì‹œ í¬í•¨!)
application-local.yml
application-dev.yml
application-prod.yml

# ê¸°íƒ€
.env
*.log
target/
build/
```

### 5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
```bash
# Gradle ì‚¬ìš© ì‹œ
./gradlew bootRun --args='--spring.profiles.active=local'

# Maven ì‚¬ìš© ì‹œ
./mvnw spring-boot:run -Dspring-boot.run.profiles=local
```

**IntelliJ IDEAì—ì„œ ì‹¤í–‰:**
1. Run â†’ Edit Configurations
2. Active profilesì— `local` ì…ë ¥
3. Apply â†’ OK
4. ì‹¤í–‰ ë²„íŠ¼ í´ë¦­

ì„œë²„ê°€ `http://localhost:8080`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

## âš™ï¸ í™˜ê²½ ì„¤ì •

### í”„ë¡œíŒŒì¼ êµ¬ì¡°
```
src/main/resources/
â”œâ”€â”€ application.yml              # ê³µí†µ ì„¤ì • (Gitì— ì»¤ë°‹)
â”œâ”€â”€ application-local.yml        # ë¡œì»¬ ê°œë°œ (Git ì œì™¸)
â”œâ”€â”€ application-dev.yml          # ê°œë°œ ì„œë²„ (Git ì œì™¸)
â””â”€â”€ application-prod.yml         # ìš´ì˜ ì„œë²„ (Git ì œì™¸)
```

### application.yml (ê³µí†µ ì„¤ì •)
```yaml
spring:
  application:
    name: manager
  datasource:
    url: jdbc:mysql://localhost:3306/classroom_db?useSSL=false&allowPublicKeyRetrieval=true
    username: classroom_user
    password: classroom_user
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: create  # ìš´ì˜: validate
    properties:
      hibernate:
        format_sql: true
    show-sql: true
  cloud:
    aws:
      s3:
        bucket: ${AWS_S3_BUCKET:default-bucket}
      region:
        static: "ap-northeast-2"
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}

admin:
  super:
    id: ${ADMIN_ID:super_admin}
    password: ${ADMIN_PASSWORD:super_admin}
    name: "ì „ì²´ ê´€ë¦¬ì"
    contact: "010-0000-0000"

class:
  code:
    - "5413"
    - "5414"
    - "5527"
    - "5507"
    - "5508"
    - "627-A"
    - "627-B"

jwt:
  access-token-expiration-day: 10
  secret-key: ${JWT_SECRET_KEY}

front:
  url: ${FRONT_URL:http://localhost:5173}
```

### í”„ë¡œíŒŒì¼ë³„ ì‹¤í–‰
```bash
# ë¡œì»¬ ê°œë°œ
./gradlew bootRun --args='--spring.profiles.active=local'

# ê°œë°œ ì„œë²„
./gradlew bootRun --args='--spring.profiles.active=dev'

# ìš´ì˜ ì„œë²„
java -jar build/libs/app.jar --spring.profiles.active=prod
```
### 5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

```bash
# Gradle ì‚¬ìš© ì‹œ
./gradlew bootRun

# ë˜ëŠ” IDEì—ì„œ ì§ì ‘ ì‹¤í–‰
```

ì„œë²„ê°€ `http://localhost:8080`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

## ğŸ“¡ API ë¬¸ì„œ

### Base URL
```
http://localhost:8080/api
```

### ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸

#### ì˜ˆì•½ ê´€ë ¨ API

```http
# ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ
GET /api/reservations/{roomCode}?yearMonth={yearMonth}

# ì˜ˆì•½ ìƒì„¸ ì¡°íšŒ
GET /api/reservations/detail/{reservationId}

# ì˜ˆì•½ ë“±ë¡
POST /api/reservations
Content-Type: application/json

{
  "memberId": "2021001",
  "contact": "010-1234-5678",
  "role": "STUDENT",
  "roomCode": "5413",
  "title": "ìŠ¤í„°ë””",
  "purpose": "ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””",
  "startDate": "2024-01-15T09:00",
  "endDate": "2024-01-15T11:00",
  "password": "1234"
}

# ì˜ˆì•½ ìˆ˜ì •
PUT /api/reservations/{reservationId}
Content-Type: application/json

{
  "memberId": "2021001",
  "contact": "010-1234-5678",
  "role": "STUDENT",
  "roomCode": "5413",
  "title": "ìŠ¤í„°ë””",
  "purpose": "ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””",
  "startDate": "2024-01-15T09:00",
  "endDate": "2024-01-15T11:00",
  "password": "1234"
}

# ì˜ˆì•½ ì·¨ì†Œ
DELETE /api/reservations/{reservationId}
Content-Type: application/json

{
    "password":"1234"
}
```

#### ê°€ì´ë“œë¼ì¸ ê´€ë ¨ API

```http
# ê°€ì´ë“œë¼ì¸ ëª©ë¡ ì¡°íšŒ
GET /api/guidelines

# ê°€ì´ë“œë¼ì¸ ìƒì„¸ ì¡°íšŒ
GET /api/guidelines/{guideLineId}

# ê°€ì´ë“œë¼ì¸ ë“±ë¡ (ê´€ë¦¬ì)
POST /api/guidelines
Authorization: Bearer {jwt-token}
Content-Type: multipart/form-data

{
  "guideLine": {
    "roomCode": "5413",
    "content": "ê°•ì˜ì‹¤ ì‚¬ìš© ê°€ì´ë“œë¼ì¸"
  },
  "files": [íŒŒì¼1, íŒŒì¼2, ...]
}
```

#### ê°•ì˜ì‹¤ ê´€ë ¨ API

```http
# ê°•ì˜ì‹¤ ëª©ë¡ ì¡°íšŒ
GET /api/classrooms
```

#### ì¸ì¦ ê´€ë ¨ API

```http
# ê´€ë¦¬ì ë¡œê·¸ì¸
POST /api/admins/login
Content-Type: application/json

{
  "adminId": "super_admin",
  "password": "super_admin"
}

# ì‘ë‹µ
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
}
```

## âš™ï¸ í™˜ê²½ ì„¤ì •

### Docker Compose ì„¤ì •

`docker-compose.yml`:

```yaml
version: '3.8'

services:
  mysql-db:
    image: mysql:8.0
    container_name: classroom-manager-db-container
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: admin
      MYSQL_DATABASE: "classroom_db"
      MYSQL_USER: "classroom_user"
      MYSQL_PASSWORD: "classroom_user"
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --default-time-zone=Asia/Seoul

volumes:
  mysql-data:
```

### MySQL ì ‘ì† ì •ë³´

```
Host: localhost
Port: 3306
Database: classroom_db
Username: classroom_user
Password: classroom_user
```

### ì´ˆê¸° ë°ì´í„°

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë°ì´í„°:

#### 1. ê´€ë¦¬ì ê³„ì •
```
ID: super_admin
Password: super_admin
Role: SUPER_ADMIN
```

#### 2. ê°•ì˜ì‹¤ ëª©ë¡
```
- 5413
- 5414
- 5527
- 5507
- 5508
- 627-A
- 627-B
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
# ê°œë…ì  ëª¨ë¸ë§
```mermaid 
erDiagram
    MEMBER {
        string member_id PK
        string contact
        string role
        string name
    }

    ADMIN {
        string admin_id PK
        string name
        string contact
        string role
        string authorization
        string active
        string password
    }

    CLASSROOM {
        bigint room_id PK
        string roomNumber UK
    }

    REPORT {
        bigint report_id PK
        string member_id FK
        bigint room_id FK
        datetime date
        string item
        string contact
        string content
        string status
    }
    
    RESERVATION {
        bigint reservation_id PK
        string member_id FK
        bigint room_id FK
        string purpose
        datetime start_time
        datetime end_time
    }
    
    GUIDELINE {
        bigint guideline_id PK
        bigint room_id FK
        string content
    }
    
    FILE {
        bigint file_id PK
        string file_type
        string file_url
        string original_filename
        bigint related_id
        string related_type "REPORT, GUIDELINE, RESERVATION"
    }
    
    MEMBER ||--o{ REPORT : "report"
    MEMBER ||--o{ RESERVATION : "reserve"
    CLASSROOM ||--o{ RESERVATION : "has"
    CLASSROOM ||--o{ REPORT : "is_related_to"
    ADMIN ||--o{ GUIDELINE :"creates"
    CLASSROOM ||--o{ GUIDELINE : "is_related_to"
    
    REPORT ||..o{ FILE : "has"
    RESERVATION ||..o{ FILE : "has"
    GUIDELINE ||..o{ FILE : "has"
```

# ë…¼ë¦¬ì  ëª¨ë¸ë§
```mermaid
erDiagram
    MEMBER {
        string member_id PK
        string contact
        Role role "STUDENT, STAFF"
        string name
    }

    ADMIN {
        string admin_id PK
        string name
        string contact
        string password
        Role role "STUDENT, STAFF"
        Authorization authorization "SUPER_ADMIN, ADMIN, EDITOR, VIEWER"
        Active active "ACTIVE, INACTIVE"
    }

    CLASSROOM {
        bigint room_id PK
        string room_code UK
    }

    REPORT {
        bigint report_id PK
        string member_id FK
        bigint room_id FK
        datetime date
        Item item "PROJECTOR, PC, SPEAKER, MICROPHONE"
        string contact
        string content
        Status status "PENDING, COMPLETED"
    }
    
    RESERVATION {
        bigint reservation_id PK
        string member_id FK
        bigint room_id FK
        string purpose
        datetime start_time
        datetime end_time
    }
    
    GUIDELINE {
        bigint guideline_id PK
        bigint room_id FK
        string admin_id FK
        string content
    }
    
    FILE {
        bigint file_id PK
        string file_url
        string file_type
        string original_filename
        bigint related_id
        string related_type "REPORT, GUIDELINE, RESERVATION"
    }
    
    MEMBER ||--o{ REPORT : "report"
    MEMBER ||--o{ RESERVATION : "reserve"
    CLASSROOM ||--o{ RESERVATION : "has"
    CLASSROOM ||--o{ REPORT : "is_related_to"
    ADMIN ||--o{ GUIDELINE :"creates"
    CLASSROOM ||--o{ GUIDELINE : "is_related_to"
```

## ğŸ“¦ ì£¼ìš” ì˜ì¡´ì„±

```gradle
dependencies {
    // Spring Boot
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    
    // Database
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // AWS
    implementation 'org.springframework.cloud:spring-cloud-starter-aws:2.2.6.RELEASE'
    
    // JWT
    implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5'
    
    // Test
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
```

## ğŸ”§ ê°œë°œ íŒ

### MySQL ì»¨í…Œì´ë„ˆ ê´€ë¦¬

```bash
# ì»¨í…Œì´ë„ˆ ì‹œì‘
docker-compose up -d

# ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker-compose down

# ë¡œê·¸ í™•ì¸
docker-compose logs -f mysql-db

# MySQL ì ‘ì†
docker exec -it classroom-manager-db-container mysql -u classroom_user -p
```

### ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”

```bash
# ì»¨í…Œì´ë„ˆ ë° ë³¼ë¥¨ ì‚­ì œ (ë°ì´í„° ì™„ì „ ì‚­ì œ)
docker-compose down -v

# ì¬ì‹œì‘
docker-compose up -d
```

### JWT í† í° í…ŒìŠ¤íŠ¸

```bash
# ë¡œê·¸ì¸
curl -X POST http://localhost:8080/api/admins/login \
  -H "Content-Type: application/json" \
  -d '{"memberId":"super_admin","password":"super_admin"}'

# ì‘ë‹µì—ì„œ í† í° ë³µì‚¬ í›„ ì‚¬ìš©
curl -X GET http://localhost:8080/api/admins/something \
  -H "Authorization: Bearer {your-token}"
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### ë³´ì•ˆ
- âš ï¸ `application.yml`ì— ìˆëŠ” AWS í‚¤ì™€ JWT secretì€ **ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”**
- í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” `.env` íŒŒì¼ ì‚¬ìš© ê¶Œì¥
- `.gitignore`ì— ë‹¤ìŒ ì¶”ê°€:
  ```
  .env
  application-local.yml
  application-prod.yml
  ```

### DDL ì„¤ì •
- ê°œë°œ: `spring.jpa.hibernate.ddl-auto: create`
- ìš´ì˜: `spring.jpa.hibernate.ddl-auto: validate` ë˜ëŠ” `none`

### CORS ì„¤ì •
- í”„ë¡ íŠ¸ì—”ë“œ URLì„ `front.url`ì— ì •í™•íˆ ì„¤ì •
- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬

**Woowa-Tech-Course** - ì˜¤í”ˆê³¼ì œ